<!DOCTYPE html>
<meta charset="utf-8">
<html>
<head>
    <title>Upload Image</title>
</head>
<body>

<form>
    <input type="email" name="email" placeholder="email"><br>
    <input type="password" name="password" placeholder="password">
        <div id="hiddenValue"></div>
    <button id="loginSubmitBtn">로그인</button>
</form>


<input type="file" id="imageInput" multiple>
<button id="submitBtn">업로드</button>
<img src="/questionsImageTest" width="300" height="200">
<script>
    var imageFiles = [];

    // add an event listener to the submit button
    document.getElementById("submitBtn").addEventListener("click", function() {
        // get the selected image files
        var input = document.getElementById("imageInput");
        var files = input.files;

        // add each file to the imageFiles array
        for (var i = 0; i < files.length; i++) {
            imageFiles.push(files[i]);
        }

        // create a new FormData object
        var formData = new FormData();
        formData.append("title", "Sample title");
        formData.append("category", "AI");
        formData.append("content", "Sample content");
        for (var i = 0; i < imageFiles.length; i++) {
            formData.append("imageFiles", imageFiles[i]);
        }

        // send the POST request
        fetch("https://localhost:8443/questions", {
            method: "POST",
            body: formData,
            headers: {
                Authorization: localStorage.getItem('accessToken'),
            }
        })
            .then(function(response) {
                return response.json();
            })
            .then(function(data) {
                console.log(data);
                window.location.href = "/";
            })
            .catch(function(error) {
                console.log(error);
            });
    })
    /** 로그인 */
    // select the login form and submit button
    const loginForm = document.querySelector('form');
    const submitBtn = document.querySelector('#loginSubmitBtn');

    // add event listener to the submit button
    submitBtn.addEventListener('click', (event) => {
        // prevent form submission
        event.preventDefault();

        // create a request object with form data
        const request = {
            email: loginForm.email.value,
            password: loginForm.password.value
        };

        // send the request as JSON data
        fetch('/students/sign-in', {
            method: 'POST',
            body: JSON.stringify(request),
            headers: {
                'Content-Type': 'application/json'
            }
        })
            .then(response => {
                console.log(response);
                console.log(response.status);
                return response.json();
            })
            .then(response => {
                // handle response
                let hiddenValue = document.getElementById("hiddenValue");
                hiddenValue.innerHTML = response.statusCode;
                console.log(response);
                localStorage.setItem('accessToken', response.data.grantType +" " +response.data.accessToken);
                console.log(localStorage.getItem('accessToken'));
            })
            .catch(error => {
                // handle error
                console.error(error);
            });
    });


</script>
</body>
</html>